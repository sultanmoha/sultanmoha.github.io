<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bakery Delivery Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Identity Services for OAuth -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- Favicon: reuse our chef/utensils logo for browser tab icon -->
    <link rel="icon" type="image/png" href="aad3f5e1-e88e-48d4-863e-a1d44e87035e.png" />
    <!-- External stylesheet for custom styles -->
    <link rel="stylesheet" href="style.css" />
</head>

<body class="min-h-screen bg-neutral-50 text-neutral-900">
    <div class="mx-auto max-w-6xl p-4 md:p-8 space-y-6">
        <!-- Unified Top Navbar -->
        <nav id="appNavbar" class="no-print sticky top-0 z-30 relative rounded-2xl border bg-white/85 dark:bg-neutral-900/85 dark:border-neutral-700 shadow-sm backdrop-blur supports-[backdrop-filter]:backdrop-blur">
            <div class="relative flex items-center gap-3 px-3 py-2">
                <!-- Hamburger (mobile) -->
                <button id="navHamburger" class="sm:hidden p-2 rounded-md border bg-white dark:bg-neutral-900 dark:border-neutral-700"
                    aria-label="Open menu" aria-controls="mobileMenu" aria-expanded="false">
                    <i id="hamburgerIcon" class="fa-solid fa-bars"></i>
                </button>

                <!-- Logo (icon only) -->
                <div class="h-9 w-9 rounded-2xl bg-gradient-to-br from-emerald-400 to-blue-500 shadow-sm flex items-center justify-center">
                    <svg class="h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor" aria-hidden="true">
                        <path d="M416 0C400 0 288 32 288 176V288c0 17.7-14.3 32-32 32H144c-17.7 0-32 14.3-32 32v32c0 17.7 14.3 32 32 32H256c88.4 0 160-71.6 160-160V16c0-5.4-4.4-9.8-9.8-9.8z" />
                    </svg>
                </div>

                <!-- Tabs (keep existing IDs for routing) -->
                <div class="flex items-center gap-1 ml-1" role="tablist" aria-label="Sections">
                    <button id="navDelivery" class="nav-tab px-2.5 py-1.5 rounded-md border text-sm transition-base bg-neutral-200 text-neutral-900 hover:bg-neutral-50 flex items-center md:flex-col gap-1"
                        role="tab" aria-selected="true">
                        <i class="fa-solid fa-truck"></i>
                        <span class="hidden lg:inline">Deliveries</span>
                        <span class="hidden sm:inline lg:hidden">Deliv</span>
                    </button>
                    <button id="navPurchases" class="nav-tab px-2.5 py-1.5 rounded-md border text-sm transition-base hover:bg-neutral-50 flex items-center md:flex-col gap-1"
                        role="tab" aria-selected="false">
                        <i class="fa-solid fa-cart-shopping"></i>
                        <span class="hidden lg:inline">Purchases Log</span>
                        <span class="hidden sm:inline lg:hidden">Purch</span>
                    </button>
                </div>

                <!-- Search: medium shows pill activator; large shows inline input; small uses hamburger menu for actions -->
                <div class="flex-1 min-w-[120px] flex justify-center">
                    <!-- Medium search pill -->
                    <button id="searchActivator" class="hidden sm:flex lg:hidden items-center gap-2 px-4 py-2 rounded-full border bg-white/70 dark:bg-neutral-900/70 dark:border-neutral-700 hover:bg-neutral-50 text-neutral-600 dark:text-neutral-300 transition-base"
                        aria-haspopup="true" aria-expanded="false" aria-controls="searchDropdown">
                        <i class="fa-solid fa-magnifying-glass text-lg"></i>
                        <span class="font-medium">Search</span>
                    </button>
                    <!-- Dropdown (also becomes inline on lg+) -->
                    <div id="searchDropdown" class="hidden absolute left-3 right-3 top-full mt-1 z-40 lg:static lg:block lg:left-auto lg:right-auto lg:top-auto lg:mt-0" role="search">
                        <div class="rounded-2xl border bg-white dark:bg-neutral-900 dark:border-neutral-700 shadow-lg lg:shadow-none p-2 lg:p-0">
                            <input id="searchInput" type="text" placeholder="Search..." aria-label="Search"
                                class="w-full rounded-xl lg:rounded-2xl border px-4 py-2 text-sm transition-base focus-visible:ring-2 focus-visible:ring-emerald-400 dark:border-neutral-700" />
                        </div>
                    </div>
                </div>

                <!-- Actions (hidden on mobile; shown from sm+) -->
                <div class="hidden sm:flex items-center gap-1">
                    <button id="navExportCsv" class="rounded-xl border px-2.5 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1" aria-label="Export CSV">
                        <i class="fa-solid fa-file-arrow-down"></i>
                        <span class="hidden lg:inline">Export CSV</span>
                        <span class="hidden sm:inline lg:hidden">CSV</span>
                    </button>
                    <button id="navExportExcel" class="rounded-xl border px-2.5 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1" aria-label="Export Excel">
                        <i class="fa-solid fa-file-excel"></i>
                        <span class="hidden lg:inline">Export Excel</span>
                        <span class="hidden sm:inline lg:hidden">XLS</span>
                    </button>
                    <button id="navImport" class="rounded-xl border px-2.5 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1" aria-label="Import">
                        <i class="fa-solid fa-file-arrow-up"></i>
                        <span class="hidden lg:inline">Import</span>
                        <span class="hidden sm:inline lg:hidden">Imp</span>
                    </button>
                    <div class="relative">
                        <button id="navSave" class="rounded-xl border px-2.5 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1" aria-haspopup="true" aria-expanded="false" aria-controls="savePanel purchaseSavePanel">
                            <i class="fa-solid fa-floppy-disk"></i>
                            <span class="hidden lg:inline">Saves</span>
                            <span class="hidden sm:inline lg:hidden">Save</span>
                        </button>
                        <!-- Global saves panels relocated here so they remain visible when legacy toolbars are hidden -->
                        <div id="savePanel" class="absolute right-0 mt-1 w-64 bg-white border rounded-lg shadow-lg p-3 space-y-2 hidden z-40 dark:bg-neutral-900 dark:border-neutral-700">
                            <!-- Populated dynamically -->
                        </div>
                        <div id="purchaseSavePanel" class="absolute right-0 mt-1 w-64 bg-white border rounded-lg shadow-lg p-3 space-y-2 hidden z-40 dark:bg-neutral-900 dark:border-neutral-700">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                    <button id="navPrint" class="rounded-xl border px-2.5 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1" aria-label="Print">
                        <i class="fa-solid fa-print"></i>
                        <span class="hidden lg:inline">Print</span>
                        <span class="hidden sm:inline lg:hidden">Print</span>
                    </button>
                    <button id="navClear" class="rounded-xl border px-2.5 py-2 text-red-600 hover:bg-red-50 transition-base flex items-center gap-1" aria-label="Clear all">
                        <i class="fa-solid fa-trash"></i>
                        <span class="hidden lg:inline">Clear All</span>
                        <span class="hidden sm:inline lg:hidden">Clear</span>
                    </button>
                </div>

                <!-- Dark mode toggle (unchanged IDs) -->
                <button id="darkToggle" class="no-print relative flex items-center ml-auto sm:ml-0" aria-label="Toggle dark mode">
                    <span id="sunIcon" class="icon sun-icon">
                        <svg class="w-full h-full fill-current" aria-hidden="true" viewBox="0 0 512 512">
                            <path d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z" />
                        </svg>
                    </span>
                    <span id="moonIcon" class="icon moon-icon">
                        <svg class="w-full h-full fill-current" aria-hidden="true" viewBox="0 0 384 512">
                            <path d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z" />
                        </svg>
                    </span>
                    <div id="darkKnob" class="knob"></div>
                </button>

                <!-- Cloud Sync (unchanged IDs + menu) -->
                <div class="relative no-print">
                    <button id="cloudSyncBtn" class="btn cloud-btn" aria-haspopup="true" aria-expanded="false" aria-label="Cloud Sync">
                        <i id="cloudMainIcon" class="fa-solid fa-cloud" aria-hidden="true"></i>
                        <span id="cloudStatusBadge" class="cloud-badge" aria-hidden="true">
                            <i id="cloudBadgeIcon" class="fa-solid fa-check"></i>
                        </span>
                        <span id="cloudStatusChip" class="sr-only" aria-live="polite">Up to date</span>
                    </button>
                    <div id="cloudSyncMenu" class="cloud-menu hidden absolute right-0 mt-2 w-56 bg-white dark:bg-neutral-900 border dark:border-neutral-700 rounded-lg shadow-lg p-2 z-40" role="menu" aria-label="Cloud sync menu">
                        <button class="cloud-item" data-action="signin" role="menuitem"><i class="fa-solid fa-right-to-bracket w-4 text-center"></i> Sign in</button>
                        <button class="cloud-item" data-action="sync" role="menuitem"><i class="fa-solid fa-rotate w-4 text-center"></i> Sync now</button>
                        <button class="cloud-item" data-action="restore" role="menuitem"><i class="fa-solid fa-cloud-arrow-down w-4 text-center"></i> Restore from cloud</button>
                        <button class="cloud-item" data-action="view" role="menuitem"><i class="fa-solid fa-database w-4 text-center"></i> View backups</button>
                        <div class="h-px my-1 bg-neutral-200 dark:bg-neutral-700"></div>
                        <label class="block text-xs px-2 pt-1 pb-2 text-neutral-500 dark:text-neutral-400">Backup passphrase (optional)</label>
                        <input id="cloudPassphrase" type="password" class="w-full px-2 py-1 rounded-md border text-sm dark:bg-neutral-900 dark:border-neutral-700" placeholder="Encrypt backups with AES-GCM" aria-label="Backup passphrase" />
                        <div class="h-px my-2 bg-neutral-200 dark:bg-neutral-700"></div>
                        <button class="cloud-item" data-action="signout" role="menuitem"><i class="fa-solid fa-right-from-bracket w-4 text-center"></i> Sign out</button>
                    </div>
                </div>
            </div>

            <!-- Mobile dropdown (hamburger) -->
            <div id="mobileMenu" class="no-print hidden absolute left-3 right-3 mt-1 z-30">
                <div class="rounded-xl border bg-white dark:bg-neutral-900 dark:border-neutral-700 shadow-lg p-2" role="menu" aria-label="Quick actions">
                    <div class="px-2 py-1 text-xs text-neutral-500 dark:text-neutral-400">Navigate</div>
                    <button id="mmNavDeliveries" class="cloud-item" role="menuitem"><i class="fa-solid fa-truck"></i> Deliveries</button>
                    <button id="mmNavPurchases" class="cloud-item" role="menuitem"><i class="fa-solid fa-cart-shopping"></i> Purchases</button>
                    <div class="h-px my-1 bg-neutral-200 dark:bg-neutral-700"></div>
                    <div class="px-2 py-1 text-xs text-neutral-500 dark:text-neutral-400">Actions</div>
                    <button id="mmExportCsv" class="cloud-item" role="menuitem"><i class="fa-solid fa-file-csv"></i> Export CSV</button>
                    <button id="mmExportExcel" class="cloud-item" role="menuitem"><i class="fa-solid fa-file-excel"></i> Export Excel</button>
                    <button id="mmImport" class="cloud-item" role="menuitem"><i class="fa-solid fa-file-arrow-up"></i> Import</button>
                    <button id="mmSave" class="cloud-item" role="menuitem"><i class="fa-solid fa-floppy-disk"></i> Saves</button>
                    <button id="mmPrint" class="cloud-item" role="menuitem"><i class="fa-solid fa-print"></i> Print</button>
                    <button id="mmClear" class="cloud-item text-red-600" role="menuitem"><i class="fa-solid fa-trash"></i> Clear all</button>
                </div>
            </div>
        </nav>

        <!-- Shop filters container; populated via script when there are shops -->
        <div id="shopFilters" class="no-print mt-2 flex flex-wrap gap-2 hidden"></div>

        <!-- Delivery Section -->
        <div id="deliverySection" class="space-y-6">
            <!-- Input Card -->
            <section class="bg-white border rounded-2xl shadow-sm transition-base hover:shadow-md no-print">
                <div class="px-5 pt-5">
                    <h2 class="text-lg font-medium">Add delivery</h2>
                </div>
                <div class="p-5 space-y-4">
                    <!-- Row 1: Date, Shop, Delivery by, Item -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3 md:gap-4 w-full">
                        <div>
                            <label class="block text-sm font-medium mb-1" for="date">Date</label>
                            <input id="date" type="date"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1" for="shop">Shop</label>
                            <input id="shop" placeholder="e.g., Corner Market"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                            <!-- Inline error message for shop -->
                            <p id="error-shop" class="text-red-600 text-xs mt-1 hidden"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1" for="deliverBy">Delivery by</label>
                            <input id="deliverBy" placeholder="e.g., Ahmed"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                        <div>
                            <div class="flex items-center justify-between">
                                <label class="block text-sm font-medium mb-1" for="item">Item</label>
                                <button id="manageList"
                                    class="text-xs underline text-neutral-600 hover:text-neutral-900 transition-base">+
                                    Add
                                    option</button>
                            </div>
                            <select id="item"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400"></select>
                            <!-- Inline error message for item -->
                            <p id="error-item" class="text-red-600 text-xs mt-1 hidden"></p>
                        </div>

                    </div> <!-- End of row 1 -->

                    <!-- Row 2: Pieces, Price Per piece, Cost Per piece, Paid Amount, Previous Balance -->
                    <!-- On medium screens arrange inputs in five columns to keep a balanced layout -->
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-3 md:gap-4 w-full">
                        <div>
                            <label class="block text-sm font-medium mb-1" for="qty">Pieces</label>
                            <input id="qty" type="number" min="1" value="1"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                            <!-- Inline error message for quantity -->
                            <p id="error-qty" class="text-red-600 text-xs mt-1 hidden"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1" for="perPiece">Price Per piece</label>
                            <input id="perPiece" inputmode="decimal" placeholder="e.g., 1.25"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                            <!-- Inline error message for per piece price -->
                            <p id="error-perPiece" class="text-red-600 text-xs mt-1 hidden"></p>
                        </div>
                        <!-- New cost per piece input for profit calculations -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="cost">Cost Per piece</label>
                            <input id="cost" inputmode="decimal" placeholder="e.g., 0.50"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1" for="paid">Paid Amount</label>
                            <input id="paid" inputmode="decimal" placeholder="e.g., 15.00"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                        <!-- Previous Balance input -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="prevBalance">Previous Balance</label>
                            <input id="prevBalance" inputmode="decimal" placeholder="e.g., 12.50"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                    </div> <!-- End of row 2 -->

                    <!-- Notes field spanning full width -->
                    <div>
                        <label class="block text-sm font-medium mb-1" for="notes">Notes</label>
                        <input id="notes" placeholder="Optional: flavors, special order, etc."
                            class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                    </div>

                    <!-- Preview boxes and Add button container: stack previews above and button centered below -->
                    <div class="flex flex-col gap-3">
                        <div class="flex flex-col md:flex-row items-stretch gap-3">
                            <!-- Total preview -->
                            <div class="rounded-2xl border bg-white px-4 py-3 shadow-sm flex-1">
                                <div class="text-sm text-neutral-500">Total</div>
                                <div id="previewTotal" class="text-xl font-semibold">—</div>
                            </div>
                            <!-- Balance preview -->
                            <div class="rounded-2xl border bg-white px-4 py-3 shadow-sm flex-1">
                                <div class="flex items-center justify-between">
                                    <!-- Updated label to reflect inclusion of previous balance -->
                                    <div class="text-sm text-neutral-500">Current Balance (Prev + Total − Paid)</div>
                                    <span id="previewBalanceTag"
                                        class="hidden text-[11px] px-2 py-0.5 rounded-full"></span>
                                </div>
                                <div id="previewBalance" class="text-xl font-semibold">—</div>
                            </div>
                            <!-- Profit preview -->
                            <div class="rounded-2xl border bg-white px-4 py-3 shadow-sm flex-1">
                                <div class="text-sm text-neutral-500">Profit (Price − Cost)</div>
                                <div id="previewProfit" class="text-xl font-semibold">—</div>
                            </div>
                        </div>
                        <div class="flex justify-center">
                            <button id="addBtn"
                                class="h-12 px-6 rounded-2xl bg-neutral-900 text-white hover:bg-neutral-800 active:scale-[.99] transition-base flex items-center gap-2">
                                <!-- Inline SVG for plus-circle icon -->
                                <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 512 512">
                                    <path
                                        d="M256 8C119.043 8 8 119.043 8 256s111.043 248 248 248 248-111.043 248-248S392.957 8 256 8zm88 272h-64v64c0 8.837-7.163 16-16 16s-16-7.163-16-16v-64h-64c-8.837 0-16-7.163-16-16s7.163-16 16-16h64v-64c0-8.837 7.163-16 16-16s16 7.163 16 16v64h64c8.837 0 16 7.163 16 16s-7.163 16-16 16z" />
                                </svg>
                                <span>Add Delivery</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Cost Calculator has been moved below the purchases table. -->

            <!-- Summary -->
            <!-- Updated to four columns on medium screens to accommodate the new Profit card -->
            <section class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- Card 1: Totals and balances -->
                <div class="bg-white border rounded-2xl shadow-sm p-4 space-y-1 transition-base hover:shadow-md">
                    <div class="text-sm text-neutral-500">Total value</div>
                    <div id="sumValue" class="text-2xl font-semibold">$0.00</div>
                    <!-- Visual separator after total value -->
                    <div class="border-t my-2"></div>
                    <div class="mt-2 text-sm space-y-2">
                        <!-- Total paid line (includes deductions) -->
                        <div class="flex justify-between"><span class="text-neutral-500">Total Paid</span> <span
                                id="sumPaid" class="font-medium">$0.00</span></div>
                        <!-- Previous balance line -->
                        <div class="flex justify-between"><span class="text-neutral-500">Previous Balance</span> <span
                                id="sumPrev" class="font-medium">$0.00</span></div>
                        <!-- Current balance line with larger text -->
                        <div class="flex items-center justify-between gap-2">
                            <span class="text-neutral-500">Current Balance</span>
                            <div class="flex items-center gap-2">
                                <span id="sumRemaining" class="text-xl font-bold">$0.00</span>
                                <span id="sumRemainingTag" class="hidden text-[11px] px-2 py-0.5 rounded-full"></span>
                            </div>
                        </div>
                    </div>
                    <!-- Edit totals button -->
                    <button id="editTotalsBtn"
                        class="mt-3 text-xs underline text-emerald-600 hover:text-emerald-800 transition-base">Edit
                        totals</button>
                    <!-- Hidden panel for editing totals -->
                    <div id="editTotalsPanel" class="mt-3 p-3 border rounded-lg bg-neutral-50 space-y-2 hidden">
                        <div class="flex items-center justify-between gap-3">
                            <label for="editTotalPaid" class="text-sm text-neutral-500">Total Paid</label>
                            <input id="editTotalPaid" type="number" inputmode="decimal" min="0" step="0.01"
                                class="w-32 rounded-md border px-2 py-1 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                        <div class="flex items-center justify-between gap-3">
                            <label for="editPrevBalance" class="text-sm text-neutral-500">Previous Balance</label>
                            <input id="editPrevBalance" type="number" inputmode="decimal" min="0" step="0.01"
                                class="w-32 rounded-md border px-2 py-1 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                        <div class="flex gap-2">
                            <button id="saveTotalsBtn"
                                class="px-3 py-1 rounded-md bg-emerald-500 text-white text-xs hover:bg-emerald-600 transition-base">Save</button>
                            <button id="cancelTotalsBtn"
                                class="px-3 py-1 rounded-md bg-neutral-200 text-neutral-700 text-xs hover:bg-neutral-300 transition-base">Cancel</button>
                        </div>
                    </div>
                </div>
                <!-- Card 2: Transactions -->
                <div class="bg-white border rounded-2xl shadow-sm p-4 transition-base hover:shadow-md">
                    <div class="text-sm text-neutral-500">Transactions</div>
                    <!-- Totals for payments and deductions -->
                    <div id="transactionsTotals" class="text-sm mt-1 space-y-1"></div>
                    <!-- Divider between totals and list -->
                    <div class="border-t my-2"></div>
                    <!-- List of transactions -->
                    <div id="transactionsList" class="space-y-2 max-h-[200px] overflow-y-auto text-sm"></div>
                    <!-- Button to add a new transaction -->
                    <button id="addTransactionBtn"
                        class="mt-2 text-xs underline text-emerald-600 hover:text-emerald-800 transition-base no-print">Add
                        transaction</button>
                    <!-- Hidden panel for adding a transaction -->
                    <div id="addTransactionPanel"
                        class="mt-2 p-3 border rounded-lg bg-neutral-50 space-y-2 hidden no-print">
                        <div class="flex items-center justify-between gap-2">
                            <label for="transDate" class="text-xs text-neutral-500">Date</label>
                            <input id="transDate" type="date"
                                class="w-36 rounded-md border px-2 py-1 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                        <div class="flex items-center justify-between gap-2">
                            <label for="transType" class="text-xs text-neutral-500">Type</label>
                            <select id="transType"
                                class="w-36 rounded-md border px-2 py-1 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400">
                                <option value="payment">Payment</option>
                                <option value="deduction">Deduction</option>
                            </select>
                        </div>
                        <div class="flex items-center justify-between gap-2">
                            <label for="transAmount" class="text-xs text-neutral-500">Amount</label>
                            <div class="flex-1">
                                <input id="transAmount" type="number" inputmode="decimal" min="0" step="0.01"
                                    class="w-full rounded-md border px-2 py-1 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                                <!-- Inline error for transaction amount -->
                                <p id="error-transAmount" class="text-red-600 text-xs mt-1 hidden"></p>
                            </div>
                        </div>
                        <div class="flex items-center justify-between gap-2">
                            <label for="transNotes" class="text-xs text-neutral-500">Notes</label>
                            <input id="transNotes" type="text"
                                class="flex-1 rounded-md border px-2 py-1 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                        <div class="flex gap-2">
                            <button id="saveTransBtn"
                                class="px-3 py-1 rounded-md bg-emerald-500 text-white text-xs hover:bg-emerald-600 transition-base">Save</button>
                            <button id="cancelTransBtn"
                                class="px-3 py-1 rounded-md bg-neutral-200 text-neutral-700 text-xs hover:bg-neutral-300 transition-base">Cancel</button>
                        </div>
                    </div>
                </div>
                <!-- Card 3: Item breakdown (with total pieces) -->
                <div class="bg-white border rounded-2xl shadow-sm p-4 transition-base hover:shadow-md print-hide">
                    <div class="text-sm text-neutral-500">Item breakdown</div>
                    <div id="itemBreakdown" class="text-sm mt-1 space-y-1"></div>
                    <div class="mt-2 text-sm flex justify-between items-baseline">
                        <span class="text-neutral-500">Total pieces</span>
                        <!-- Make total pieces stand out more with larger, bolder, colored text -->
                        <span id="sumPieces" class="text-xl font-semibold text-emerald-600">0</span>
                    </div>
                </div>

                <!-- Card 4: Total profit -->
                <div
                    class="bg-white border print-hide rounded-2xl shadow-sm p-4 space-y-1 transition-base hover:shadow-md">
                    <div class="text-sm text-neutral-500">Total profit</div>
                    <div id="sumProfit" class="text-2xl font-semibold">$0.00</div>
                    <!-- Description to clarify calculation -->
                    <p class="text-xs text-neutral-500">Calculated as (price − cost) × pieces across all deliveries.</p>
                </div>
            </section>


            <!-- Charts Section -->
            <!-- New analytics charts visualizing deliveries and revenue. Hidden when printing. -->
            <section id="chartsSection" class="grid grid-cols-1 md:grid-cols-2 gap-4 no-print">
                <!-- Deliveries by Item chart card -->
                <div class="bg-white border rounded-2xl shadow-sm p-4 transition-base hover:shadow-md">
                    <h3 class="text-sm text-neutral-500 mb-2">Deliveries by Item</h3>
                    <!-- Reduce chart height to make the dashboard more balanced on desktop -->
                    <canvas id="deliveriesChart" class="w-full h-48"></canvas>
                </div>
                <!-- Revenue by Shop chart card -->
                <div class="bg-white border rounded-2xl shadow-sm p-4 transition-base hover:shadow-md">
                    <h3 class="text-sm text-neutral-500 mb-2">Revenue by Shop</h3>
                    <canvas id="revenueChart" class="w-full h-48"></canvas>
                </div>
            </section>

            <!-- Shop Balances Section -->
            <!-- Summary of totals for each shop including value, paid, previous, current balance and profit -->
            <section id="shopBalancesSection"
                class="bg-white border rounded-2xl shadow-sm p-4 no-print transition-base hover:shadow-md">
                <h3 class="text-sm text-neutral-500 mb-2">Shop balances</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm table-striped">
                        <thead>
                            <tr class="text-left text-neutral-500 border-b">
                                <th class="py-2 pr-3">Shop</th>
                                <th class="py-2 pr-3 text-right">Pieces</th>
                                <th class="py-2 pr-3 text-right">Value</th>
                                <th class="py-2 pr-3 text-right">Paid</th>
                                <th class="py-2 pr-3 text-right">Prev</th>
                                <th class="py-2 pr-3 text-right">Current</th>
                                <th class="py-2 pr-3 text-right">Profit</th>
                            </tr>
                        </thead>
                        <tbody id="shopBalancesBody">
                            <!-- Populated dynamically in script.js -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Shop filter tabs removed (shop filters handled in script via #shopFilters) -->

            <!-- Table -->
            <section class="bg-white border rounded-2xl shadow-sm transition-base hover:shadow-md">
                <div class="flex flex-wrap items-center justify-between px-5 pt-5 gap-3 no-print">
                    <!-- Heading with shop selector -->
                    <div class="flex items-center gap-2">
                        <h2 class="text-lg font-medium">Deliveries</h2>
                        <!-- Dropdown for selecting shop filter (replaces tabs) -->
                        <select id="shopDropdown" class="rounded-md border px-3 py-1 text-sm">
                            <option value="">All Shops</option>
                        </select>
                    </div>
                <div class="flex gap-2 no-print hidden">
                        <button id="exportCsvBtn"
                            class="rounded-xl border px-3 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1">
                            <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 512 512">
                                <path
                                    d="M0 64C0 28.7 28.7 0 64 0L224 0l0 128c0 17.7 14.3 32 32 32l128 0 0 144-208 0c-35.3 0-64 28.7-64 64l0 144-48 0c-35.3 0-64-28.7-64-64L0 64zm384 64l-128 0L256 0 384 128zM200 352l16 0c22.1 0 40 17.9 40 40l0 8c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-8c0-4.4-3.6-8-8-8l-16 0c-4.4 0-8 3.6-8 8l0 80c0 4.4 3.6 8 8 8l16 0c4.4 0 8-3.6 8-8l0-8c0-8.8 7.2-16 16-16s16 7.2 16 16l0 8c0 22.1-17.9 40-40 40l-16 0c-22.1 0-40-17.9-40-40l0-80c0-22.1 17.9-40 40-40zm133.1 0l34.9 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-34.9 0c-7.2 0-13.1 5.9-13.1 13.1c0 5.2 3 9.9 7.8 12l37.4 16.6c16.3 7.2 26.8 23.4 26.8 41.2c0 24.9-20.2 45.1-45.1 45.1L304 512c-8.8 0-16-7.2-16-16s7.2-16 16-16l42.9 0c7.2 0 13.1-5.9 13.1-13.1c0-5.2-3-9.9-7.8-12l-37.4-16.6c-16.3-7.2-26.8-23.4-26.8-41.2c0-24.9 20.2-45.1 45.1-45.1zm98.9 0c8.8 0 16 7.2 16 16l0 31.6c0 23 5.5 45.6 16 66c10.5-20.3 16-42.9 16-66l0-31.6c0-8.8 7.2-16 16-16s16 7.2 16 16l0 31.6c0 34.7-10.3 68.7-29.6 97.6l-5.1 7.7c-3 4.5-8 7.1-13.3 7.1s-10.3-2.7-13.3-7.1l-5.1-7.7c-19.3-28.9-29.6-62.9-29.6-97.6l0-31.6c0-8.8 7.2-16 16-16z" />
                            </svg>
                            <span>Export CSV</span>
                        </button>
                        <button id="exportExcelBtn"
                            class="rounded-xl border px-3 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1">
                            <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 384 512">
                                <path
                                    d="M64 0C28.7 0 0 28.7 0 64L0 448c0 35.3 28.7 64 64 64l256 0c35.3 0 64-28.7 64-64l0-288-128 0c-17.7 0-32-14.3-32-32L224 0 64 0zM256 0l0 128 128 0L256 0zM155.7 250.2L192 302.1l36.3-51.9c7.6-10.9 22.6-13.5 33.4-5.9s13.5 22.6 5.9 33.4L221.3 344l46.4 66.2c7.6 10.9 5 25.8-5.9 33.4s-25.8 5-33.4-5.9L192 385.8l-36.3 51.9c-7.6 10.9-22.6 13.5-33.4 5.9s-13.5-22.6-5.9-33.4L162.7 344l-46.4-66.2c-7.6-10.9-5-25.8 5.9-33.4s25.8-5 33.4 5.9z" />
                            </svg>
                            <span>Export Excel</span>
                        </button>
                        <button id="printBtn"
                            class="rounded-xl border px-3 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1">
                            <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 512 512">
                                <path
                                    d="M128 0C92.7 0 64 28.7 64 64l0 96 64 0 0-96 226.7 0L384 93.3l0 66.7 64 0 0-66.7c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0L128 0zM384 352l0 32 0 64-256 0 0-64 0-16 0-16 256 0zm64 32l32 0c17.7 0 32-14.3 32-32l0-96c0-35.3-28.7-64-64-64L64 192c-35.3 0-64 28.7-64 64l0 96c0 17.7 14.3 32 32 32l32 0 0 64c0 35.3 28.7 64 64 64l256 0c35.3 0 64-28.7 64-64l0-64zM432 248a24 24 0 1 1 0 48 24 24 0 1 1 0-48z" />
                            </svg>
                            <span>Print</span>
                        </button>
                        <!-- Import button with icon -->
                        <button id="importBtn"
                            class="rounded-xl border px-3 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1">
                            <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 512 512">
                                <path
                                    d="M128 64c0-35.3 28.7-64 64-64L352 0l0 128c0 17.7 14.3 32 32 32l128 0 0 288c0 35.3-28.7 64-64 64l-256 0c-35.3 0-64-28.7-64-64l0-112 174.1 0-39 39c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l80-80c9.4-9.4 9.4-24.6 0-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l39 39L128 288l0-224zm0 224l0 48L24 336c-13.3 0-24-10.7-24-24s10.7-24 24-24l104 0zM512 128l-128 0L384 0 512 128z" />
                            </svg>
                            <span>Import</span>
                        </button>
                        <!-- Saves dropdown trigger -->
                    <div class="relative">
                        <button id="saveBtn"
                            class="rounded-xl border px-3 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1">
                            <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 448 512">
                                <path d="M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-242.7c0-17-6.7-33.3-18.7-45.3L352 50.7C340 38.7 323.7 32 306.7 32L64 32zm0 96c0-17.7 14.3-32 32-32l192 0c17.7 0 32 14.3 32 32l0 64c0 17.7-14.3 32-32 32L96 224c-17.7 0-32-14.3-32-32l0-64zM224 288a64 64 0 1 1 0 128 64 64 0 1 1 0-128z" />
                            </svg>
                            <span class="sr-only">Saves (legacy trigger)</span>
                        </button>
                    </div>
                        <button id="clearBtn"
                            class="rounded-xl border px-3 py-2 text-red-600 hover:bg-red-50 transition-base flex items-center gap-1">
                            <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 448 512">
                                <path
                                    d="M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z" />
                            </svg>
                            <span>Clear all</span>
                        </button>
                    </div>
                </div>
                <!-- Global search input for filtering deliveries -->
                <div class="px-5 pb-3 no-print hidden"></div>
                <div class="p-5 overflow-x-auto">
                    <table class="w-full text-sm table-striped">
                        <thead>
                            <tr class="text-left text-neutral-500 border-b">
                                <th class="py-2 pr-3">#</th>
                                <!-- Add data-sort attributes to enable sorting in script -->
                                <th class="py-2 pr-3 cursor-pointer" data-sort="date">Date</th>
                                <th class="py-2 pr-3 cursor-pointer" data-sort="shop">Shop</th>
                                <th class="py-2 pr-3 print-hide cursor-pointer" data-sort="deliveredBy">By</th>
                                <th class="py-2 pr-3 cursor-pointer" data-sort="item">Item</th>
                                <!-- Category column remains hidden -->
                                <th class="py-2 pr-3 cursor-pointer" data-sort="qty">Qty</th>
                                <th class="py-2 pr-3 cursor-pointer" data-sort="per">Per piece</th>
                                <th class="py-2 pr-3 cursor-pointer" data-sort="total">Total</th>
                                <th class="py-2 pr-3 cursor-pointer" data-sort="paid">Paid</th>
                                <th class="py-2 pr-3 cursor-pointer" data-sort="balance">Balance</th>
                                <th class="py-2 pr-3 print-hide">Notes</th>
                                <th class="py-2 pr-3 print-hide">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="rowsBody">
                            <tr id="emptyRow">
                                <td class="py-3 text-neutral-500" colspan="11">No entries yet. Add your first delivery
                                    above.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Print summary for totals (hidden on screen, shown in print) -->
            <div id="printSummary" class="hidden print:block mt-4"></div>

        </div> <!-- End Delivery Section -->

        <!-- Purchases Log Section -->
        <div id="purchasesSection" class="space-y-6 hidden">
            <!-- Add purchase card -->
            <section class="bg-white border rounded-2xl shadow-sm transition-base hover:shadow-md no-print">
                <div class="px-5 pt-5">
                    <h2 class="text-lg font-medium">Add purchase</h2>
                </div>
                <div class="p-5 space-y-4">
                    <!-- Input fields row -->
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-3 md:gap-4 w-full">
                        <div>
                            <label class="block text-sm font-medium mb-1" for="purchaseDate">Date</label>
                            <input id="purchaseDate" type="date"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                        <div>
                            <div class="flex items-center justify-between">
                                <label class="block text-sm font-medium mb-1" for="purchaseItem">Item</label>
                                <button id="managePurchaseListBtn"
                                    class="text-xs underline text-neutral-600 hover:text-neutral-900 transition-base">+
                                    Add item</button>
                            </div>
                            <select id="purchaseItem"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400"></select>
                            <!-- Inline error message for purchase item -->
                            <p id="error-purchaseItem" class="text-red-600 text-xs mt-1 hidden"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1" for="purchaseQty">Quantity</label>
                            <input id="purchaseQty" type="number" min="0" step="any"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                            <!-- Inline error message for purchase quantity -->
                            <p id="error-purchaseQty" class="text-red-600 text-xs mt-1 hidden"></p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1" for="purchaseUnit">Unit</label>
                            <select id="purchaseUnit"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400">
                                <option value="lb">lb</option>
                                <option value="kg">kg</option>
                                <option value="gallon">gallon</option>
                                <option value="liter">liter</option>
                                <option value="dozen">dozen</option>
                                <option value="unit">unit</option>
                                <option value="pack">pack</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1" for="purchasePaid">Total paid</label>
                            <input id="purchasePaid" type="number" min="0" step="0.01"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                            <!-- Inline error message for total paid -->
                            <p id="error-purchasePaid" class="text-red-600 text-xs mt-1 hidden"></p>
                        </div>
                    </div>
                    <!-- Add purchase button -->
                    <div class="flex justify-center">
                        <button id="addPurchaseBtn"
                            class="h-10 px-6 rounded-2xl bg-neutral-900 text-white hover:bg-neutral-800 active:scale-[.99] transition-base flex items-center gap-2">
                            <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 512 512">
                                <path
                                    d="M256 8C119.043 8 8 119.043 8 256s111.043 248 248 248 248-111.043 248-248S392.957 8 256 8zm88 272h-64v64c0 8.837-7.163 16-16 16s-16-7.163-16-16v-64h-64c-8.837 0-16-7.163-16-16s7.163-16 16-16h64v-64c0-8.837 7.163-16 16-16s16 7.163 16 16v64h64c8.837 0 16 7.163 16 16s-7.163 16-16 16z" />
                            </svg>
                            <span>Add Purchase</span>
                        </button>
                    </div>
                </div>
            </section>
            <!-- Purchases table and actions -->
            <section class="bg-white border rounded-2xl shadow-sm transition-base hover:shadow-md">
                <div class="flex flex-wrap items-center justify-between px-5 pt-5 gap-3 no-print">
                    <h2 class="text-lg font-medium">Purchases</h2>
                    <div class="flex gap-2 no-print hidden">
                        <!-- Export CSV -->
                        <button id="exportPurchasesCsvBtn"
                            class="rounded-xl border px-3 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1">
                            <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 512 512">
                                <path
                                    d="M0 64C0 28.7 28.7 0 64 0L224 0l0 128c0 17.7 14.3 32 32 32l128 0 0 144-208 0c-35.3 0-64 28.7-64 64l0 144-48 0c-35.3 0-64-28.7-64-64L0 64zm384 64l-128 0L256 0 384 128zM200 352l16 0c22.1 0 40 17.9 40 40l0 8c0 8.8-7.2 16-16 16s-16-7.2-16-16l0-8c0-4.4-3.6-8-8-8l-16 0c-4.4 0-8 3.6-8 8l0 80c0 4.4 3.6 8 8 8l16 0c4.4 0 8-3.6 8-8l0-8c0-8.8 7.2-16 16-16s16 7.2 16 16l0 8c0 22.1-17.9 40-40 40l-16 0c-22.1 0-40-17.9-40-40l0-80c0-22.1 17.9-40 40-40zm133.1 0l34.9 0c8.8 0 16 7.2 16 16s-7.2 16-16 16l-34.9 0c-7.2 0-13.1 5.9-13.1 13.1c0 5.2 3 9.9 7.8 12l37.4 16.6c16.3 7.2 26.8 23.4 26.8 41.2c0 24.9-20.2 45.1-45.1 45.1L304 512c-8.8 0-16-7.2-16-16s7.2-16 16-16l42.9 0c7.2 0 13.1-5.9 13.1-13.1c0-5.2-3-9.9-7.8-12l-37.4-16.6c-16.3-7.2-26.8-23.4-26.8-41.2c0-24.9 20.2-45.1 45.1-45.1zm98.9 0c8.8 0 16 7.2 16 16l0 31.6c0 23 5.5 45.6 16 66c10.5-20.3 16-42.9 16-66l0-31.6c0-8.8 7.2-16 16-16s16 7.2 16 16l0 31.6c0 34.7-10.3 68.7-29.6 97.6l-5.1 7.7c-3 4.5-8 7.1-13.3 7.1s-10.3-2.7-13.3-7.1l-5.1-7.7c-19.3-28.9-29.6-62.9-29.6-97.6l0-31.6c0-8.8 7.2-16 16-16z" />
                            </svg>
                            <span>Export CSV</span>
                        </button>
                        <!-- Export Excel -->
                        <button id="exportPurchasesExcelBtn"
                            class="rounded-xl border px-3 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1">
                            <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 384 512">
                                <path
                                    d="M64 0C28.7 0 0 28.7 0 64L0 448c0 35.3 28.7 64 64 64l256 0c35.3 0 64-28.7 64-64l0-288-128 0c-17.7 0-32-14.3-32-32L224 0 64 0zM256 0l0 128 128 0L256 0zM155.7 250.2L192 302.1l36.3-51.9c7.6-10.9 22.6-13.5 33.4-5.9s13.5 22.6 5.9 33.4L221.3 344l46.4 66.2c7.6 10.9 5 25.8-5.9 33.4s-25.8 5-33.4-5.9L192 385.8l-36.3 51.9c-7.6 10.9-22.6 13.5-33.4 5.9s-13.5-22.6-5.9-33.4L162.7 344l-46.4-66.2c-7.6-10.9-5-25.8 5.9-33.4s25.8-5 33.4 5.9z" />
                            </svg>
                            <span>Export Excel</span>
                        </button>
                        <!-- Print -->
                        <button id="printPurchasesBtn"
                            class="rounded-xl border px-3 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1">
                            <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 512 512">
                                <path
                                    d="M128 0C92.7 0 64 28.7 64 64l0 96 64 0 0-96 226.7 0L384 93.3l0 66.7 64 0 0-66.7c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0L128 0zM384 352l0 32 0 64-256 0 0-64 0-16 0-16 256 0zm64 32l32 0c17.7 0 32-14.3 32-32l0-96c0-35.3-28.7-64-64-64L64 192c-35.3 0-64 28.7-64 64l0 96c0 17.7 14.3 32 32 32l32 0 0 64c0 35.3 28.7 64 64 64l256 0c35.3 0 64-28.7 64-64l0-64zM432 248a24 24 0 1 1 0 48 24 24 0 1 1 0-48z" />
                            </svg>
                            <span>Print</span>
                        </button>
                        <!-- Import -->
                        <button id="importPurchasesBtn"
                            class="rounded-xl border px-3 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1">
                            <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 512 512">
                                <path
                                    d="M128 64c0-35.3 28.7-64 64-64L352 0l0 128c0 17.7 14.3 32 32 32l128 0 0 288c0 35.3-28.7 64-64 64l-256 0c-35.3 0-64-28.7-64-64l0-112 174.1 0-39 39c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l80-80c9.4-9.4 9.4-24.6 0-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l39 39L128 288l0-224zm0 224l0 48L24 336c-13.3 0-24-10.7-24-24s10.7-24 24-24l104 0zM512 128l-128 0L384 0 512 128z" />
                            </svg>
                            <span>Import</span>
                        </button>
                        <!-- Saves (use existing save panel) -->
                        <div class="relative">
                            <button id="savePurchasesBtn"
                                class="rounded-xl border px-3 py-2 hover:bg-neutral-50 transition-base flex items-center gap-1">
                                <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 448 512">
                                    <path d="M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-242.7c0-17-6.7-33.3-18.7-45.3L352 50.7C340 38.7 323.7 32 306.7 32L64 32zm0 96c0-17.7 14.3-32 32-32l192 0c17.7 0 32 14.3 32 32l0 64c0 17.7-14.3 32-32 32L96 224c-17.7 0-32-14.3-32-32l0-64zM224 288a64 64 0 1 1 0 128 64 64 0 1 1 0-128z" />
                                </svg>
                                <span class="sr-only">Saves (legacy trigger)</span>
                            </button>
                        </div>
                        <!-- Clear all -->
                        <button id="clearPurchasesBtn"
                            class="rounded-xl border px-3 py-2 text-red-600 hover:bg-red-50 transition-base flex items-center gap-1">
                            <svg class="w-4 h-4 fill-current" aria-hidden="true" viewBox="0 0 448 512">
                                <path
                                    d="M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z" />
                            </svg>
                            <span>Clear all</span>
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm table-striped">
                        <thead>
                            <tr class="text-left text-neutral-500 border-b">
                                <th class="py-2 px-3">Date</th>
                                <th class="py-2 px-3">Item</th>
                                <th class="py-2 px-3 text-right">Qty</th>
                                <th class="py-2 px-3">Unit</th>
                                <th class="py-2 px-3 text-right">Unit Price</th>
                                <th class="py-2 px-3 text-right">Total Paid</th>
                                <th class="py-2 px-3">Derived Cost</th>
                                <th class="py-2 px-3 print-hide">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="purchasesTableBody">
                            <!-- Rows inserted by script -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Cost Calculator integrated into Purchases page -->
            <section id="purchasesCalculator"
                class="bg-white border rounded-2xl shadow-sm transition-base hover:shadow-md mt-6 no-print">
                <div class="px-5 pt-5">
                    <h2 class="text-lg font-medium">Cost Calculator</h2>
                </div>
                <div class="p-5 space-y-4">
                    <!-- Inputs grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 w-full">
                        <!-- Sugar used -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="calcSugarQty">Sugar used (lbs)</label>
                            <input id="calcSugarQty" type="number" min="0" step="any"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                            <div id="calcSugarUnitLabel" class="text-xs text-neutral-500 mt-1">Unit: $0.00/lb</div>
                        </div>
                        <!-- Flour used -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="calcFlourQty">Flour used (lbs)</label>
                            <input id="calcFlourQty" type="number" min="0" step="any"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                            <div id="calcFlourUnitLabel" class="text-xs text-neutral-500 mt-1">Unit: $0.00/lb</div>
                        </div>
                        <!-- Milk used -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="calcMilkQty">Milk used (cups)</label>
                            <input id="calcMilkQty" type="number" min="0" step="any"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                            <div id="calcMilkUnitLabel" class="text-xs text-neutral-500 mt-1">Unit: $0.00/cup</div>
                        </div>
                        <!-- Eggs used -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="calcEggQty">Eggs used</label>
                            <input id="calcEggQty" type="number" min="0" step="1"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                            <!-- Note: renamed id to calcEggsUnitLabel to align with script keys -->
                            <div id="calcEggsUnitLabel" class="text-xs text-neutral-500 mt-1">Unit: $0.00/egg</div>
                        </div>
                        <!-- Oil used -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="calcOilQty">Oil used (cups)</label>
                            <input id="calcOilQty" type="number" min="0" step="any"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                            <div id="calcOilUnitLabel" class="text-xs text-neutral-500 mt-1">Unit: $0.00/cup</div>
                        </div>
                        <!-- Coconut used -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="calcCoconutQty">Coconut used
                                (lbs)</label>
                            <input id="calcCoconutQty" type="number" min="0" step="any"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                            <div id="calcCoconutUnitLabel" class="text-xs text-neutral-500 mt-1">Unit: $0.00/lb</div>
                        </div>
                        <!-- Sesame used -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="calcSesameQty">Sesame used (lbs)</label>
                            <input id="calcSesameQty" type="number" min="0" step="any"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                            <div id="calcSesameUnitLabel" class="text-xs text-neutral-500 mt-1">Unit: $0.00/lb</div>
                        </div>
                        <!-- Packaging cost per piece -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="calcPackagingCost">Packaging cost per
                                piece ($)</label>
                            <input id="calcPackagingCost" type="number" min="0" step="0.01"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                            <div id="calcPackagingUnitLabel" class="text-xs text-neutral-500 mt-1">Unit: $0.00/piece
                            </div>
                        </div>
                        <!-- Electricity used -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="calcElectricityKwh">Electricity used
                                (kWh)</label>
                            <input id="calcElectricityKwh" type="number" min="0" step="any"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                        <!-- Rate per kWh -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="calcElectricityRate">Rate per kWh
                                ($)</label>
                            <input id="calcElectricityRate" type="number" min="0" step="0.01"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                        <!-- Pieces produced -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="calcPieces">Pieces produced</label>
                            <input id="calcPieces" type="number" min="0" step="1"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                        <!-- Price per piece -->
                        <div>
                            <label class="block text-sm font-medium mb-1" for="calcPrice">Price per piece ($)</label>
                            <input id="calcPrice" type="number" min="0" step="0.01"
                                class="w-full rounded-xl border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                        </div>
                    </div>
                    <!-- Calculate & Save buttons -->
                    <div class="flex justify-center gap-3">
                        <button id="calcComputeBtn"
                            class="h-12 px-6 rounded-2xl bg-neutral-900 text-white hover:bg-neutral-800 active:scale-[.99] transition-base flex items-center gap-2">
                            <!-- Font Awesome calculator icon -->
                            <i class="fa-solid fa-calculator"></i>
                            <span>Calculate</span>
                        </button>
                        <button id="calcSaveBtn"
                            class="h-12 px-6 rounded-2xl bg-neutral-900 text-white hover:bg-neutral-800 active:scale-[.99] transition-base flex items-center gap-2">
                            <!-- Font Awesome save icon -->
                            <i class="fa-solid fa-save"></i>
                            <span>Save</span>
                        </button>
                    </div>
                    <!-- Inline error for calculator save -->
                    <p id="calcSaveError" class="text-red-600 text-xs mt-1 hidden"></p>
                    <!-- Results preview -->
                    <!--
                      Extend the results grid to include total profit across all pieces.
                      The md:grid-cols-3 class is changed to md:grid-cols-4 to accommodate
                      the extra card on medium and larger screens. On small screens it
                      gracefully stacks in a single column.
                    -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mt-4">
                        <!-- Total cost -->
                        <div class="rounded-2xl border bg-white px-4 py-3 shadow-sm flex flex-col">
                            <div class="text-sm text-neutral-500">Total Cost</div>
                            <div id="calcTotalCost" class="text-xl font-semibold">—</div>
                        </div>
                        <!-- Cost per piece -->
                        <div class="rounded-2xl border bg-white px-4 py-3 shadow-sm flex flex-col">
                            <div class="text-sm text-neutral-500">Cost per piece</div>
                            <div id="calcCostPerPiece" class="text-xl font-semibold">—</div>
                        </div>
                        <!-- Profit per piece -->
                        <div class="rounded-2xl border bg-white px-4 py-3 shadow-sm flex flex-col">
                            <div class="text-sm text-neutral-500">Profit per piece</div>
                            <div id="calcProfitPerPiece" class="text-xl font-semibold">—</div>
                        </div>
                        <!-- Total profit across all pieces -->
                        <div class="rounded-2xl border bg-white px-4 py-3 shadow-sm flex flex-col">
                            <div class="text-sm text-neutral-500">Total profit</div>
                            <div id="calcTotalProfit" class="text-xl font-semibold">—</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Saved calculator results section. Hidden when there are no saved results. -->
            <section id="calcSavesSection"
                class="bg-white border rounded-2xl shadow-sm transition-base hover:shadow-md mt-6 no-print hidden">
                <div class="px-5 pt-5">
                    <h2 class="text-lg font-medium">Saved Results</h2>
                </div>
                <div id="calcSavesContainer" class="p-5 space-y-4 text-sm">
                    <!-- Results will be dynamically populated here via script.js -->
                </div>
            </section>
        </div> <!-- End Purchases Section -->

        <!-- Calculator Section removed; integrated into Purchases page -->

        <footer class="text-xs text-neutral-500 text-center">Built by Mohamed • Data saved in your browser • No login
            needed</footer>
    </div>



    <!-- Toast notification container (hidden by default) -->
    <div id="toast"
        class="fixed bottom-4 right-4 z-50 px-4 py-2 rounded-lg shadow-lg text-white opacity-0 pointer-events-none transition-opacity duration-300">
    </div>

    <!-- Modal for adding a new item/category -->
    <div id="modalBackdrop" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-5 rounded-2xl shadow-lg w-full max-w-sm space-y-4">
            <div class="text-lg font-medium" id="modalTitle">Add option</div>
            <div class="space-y-2">
                <label for="modalInput" class="block text-sm text-neutral-500">Name</label>
                <input id="modalInput" type="text"
                    class="w-full rounded-lg border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                <p id="modalError" class="text-red-600 text-sm hidden"></p>
            </div>
            <div class="flex justify-end gap-2">
                <button id="modalCancel"
                    class="px-3 py-1 rounded-md bg-neutral-200 text-neutral-700 text-sm hover:bg-neutral-300 transition-base">Cancel</button>
                <button id="modalSave"
                    class="px-3 py-1 rounded-md bg-emerald-600 text-white text-sm hover:bg-emerald-700 transition-base">Save</button>
            </div>
        </div>
    </div>

    <!-- Modal for import wizard -->
    <div id="importBackdrop" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div id="importModal" class="bg-white p-5 rounded-2xl shadow-lg w-full max-w-3xl space-y-4 overflow-y-auto">
            <!-- Import wizard content will be populated dynamically in script.js -->
        </div>
    </div>

    <!-- Modal for clearing all data -->
    <div id="clearModalBackdrop" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-5 rounded-2xl shadow-lg w-full max-w-sm space-y-4">
            <div class="text-lg font-medium">Clear all data</div>
            <p class="text-sm text-neutral-600">Are you sure you want to delete all deliveries, transactions, and
                settings? This cannot be undone.</p>
            <div class="flex justify-end gap-2">
                <button id="clearCancelBtn"
                    class="px-3 py-1 rounded-md bg-neutral-200 text-neutral-700 text-sm hover:bg-neutral-300 transition-base">Cancel</button>
                <button id="clearConfirmBtn"
                    class="px-3 py-1 rounded-md bg-red-600 text-white text-sm hover:bg-red-700 transition-base">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Modal for naming saves and selecting shop -->
    <div id="saveNameBackdrop" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-5 rounded-2xl shadow-lg w-full max-w-sm space-y-4">
            <div class="text-lg font-medium">Create Save</div>
            <div class="space-y-2">
                <label for="saveNameInput" class="block text-sm text-neutral-500">Name<span
                        class="text-red-500">*</span></label>
                <input id="saveNameInput" type="text" required
                    class="w-full rounded-lg border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
                <p id="saveNameError" class="text-red-600 text-sm hidden">Please enter a name.</p>
            </div>
            <div class="flex justify-end gap-2">
                <button id="saveNameCancel"
                    class="px-3 py-1 rounded-md bg-neutral-200 text-neutral-700 text-sm hover:bg-neutral-300 transition-base">Cancel</button>
                <button id="saveNameSave"
                    class="px-3 py-1 rounded-md bg-emerald-600 text-white text-sm hover:bg-emerald-700 transition-base">Save</button>
            </div>
        </div>
    </div>

    <!-- Modal for confirming save deletion -->
    <div id="deleteSaveBackdrop" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-5 rounded-2xl shadow-lg w-full max-w-sm space-y-4">
            <div class="text-lg font-medium">Delete Save</div>
            <p class="text-sm text-neutral-600">Type <strong>DELETE</strong> to confirm deletion.</p>
            <input id="deleteSaveInput" type="text"
                class="w-full rounded-lg border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400" />
            <div class="flex justify-end gap-2">
                <button id="deleteSaveCancel"
                    class="px-3 py-1 rounded-md bg-neutral-200 text-neutral-700 text-sm hover:bg-neutral-300 transition-base">Cancel</button>
                <button id="deleteSaveConfirm"
                    class="px-3 py-1 rounded-md bg-red-600 text-white text-sm hover:bg-red-700 transition-base"
                    disabled>Delete</button>
            </div>
        </div>
    </div>

    <!-- Generic alert modal (for notifications and warnings) -->
    <div id="alertModalBackdrop"
        class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden no-print">
        <!-- Use a consistent light style for modals instead of dark overrides. -->
        <div class="bg-white p-5 rounded-2xl shadow-lg w-full max-w-sm space-y-4">
            <div id="alertModalTitle" class="text-lg font-medium text-neutral-900">Alert</div>
            <p id="alertModalMessage" class="text-sm text-neutral-600"></p>
            <div class="flex justify-end">
                <button id="alertModalOk"
                    class="px-3 py-1 rounded-md bg-emerald-600 text-white text-sm hover:bg-emerald-700 transition-base">OK</button>
            </div>
        </div>
    </div>

    <!-- Generic confirm modal (used for deletion and other confirmations) -->
    <div id="confirmModalBackdrop"
        class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden no-print">
        <!-- Use a consistent light style for modals instead of dark overrides. -->
        <div class="bg-white p-5 rounded-2xl shadow-lg w-full max-w-sm space-y-4">
            <div id="confirmModalTitle" class="text-lg font-medium text-neutral-900">Confirm
                Action</div>
            <p id="confirmModalMessage" class="text-sm text-neutral-600"></p>
            <div class="flex justify-end gap-2">
                <button id="confirmModalCancel"
                    class="px-3 py-1 rounded-md bg-neutral-200 text-neutral-700 text-sm hover:bg-neutral-300 transition-base">Cancel</button>
                <!-- Confirm button styling is set dynamically via script; default placeholder here -->
                <button id="confirmModalConfirm"
                    class="px-3 py-1 rounded-md text-white text-sm transition-base">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Modal for selecting an item when saving calculator results -->
    <div id="calcSaveItemBackdrop" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-5 rounded-2xl shadow-lg w-full max-w-xs space-y-4">
            <div class="text-lg font-medium">Save Result As</div>
            <div class="space-y-2">
                <label for="calcSaveItemSelect" class="block text-sm text-neutral-500">Item</label>
                <select id="calcSaveItemSelect"
                    class="w-full rounded-lg border px-3 py-2 transition-base focus-visible:ring-2 focus-visible:ring-emerald-400"></select>
                <button id="calcAddItemBtn"
                    class="text-xs underline text-emerald-600 hover:text-emerald-800 transition-base">+ Add new
                    item</button>
            </div>
            <div class="flex justify-end gap-2">
                <button id="calcSaveItemCancel"
                    class="px-3 py-1 rounded-md bg-neutral-200 text-neutral-700 text-sm hover:bg-neutral-300 transition-base">Cancel</button>
                <button id="calcSaveItemSave"
                    class="px-3 py-1 rounded-md bg-emerald-600 text-white text-sm hover:bg-emerald-700 transition-base">Save</button>
            </div>
        </div>
    </div>

    <!-- Chart.js library for analytics visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="script.js"></script>
    <!-- Google Drive Sync (loads GIS/gapi internally; no other changes) -->
    <script src="sync/googleDriveSync.js"></script>
</body>

</html>

</body>

</html>
